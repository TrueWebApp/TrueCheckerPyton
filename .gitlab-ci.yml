stages:
  - test
  - release


linters:
  image: python:3.8-slim-buster
  stage: test
  script:
    - pip install mypy flake8 black
    - mypy .
    - flake .
    - black .


pytest:
  stage: test
  image: python:3.8
  script:
    - pip install pytest pytest-cov poetry
    - poetry export --dev -f requirements.txt -o requirements.txt
    - pip install -r requirements.txt
    - pytest --cov=truechecker/ tests/
    - coverage xml
  artifacts:
    reports:
      cobertura: coverage.xml


pypi:
  image: python:3.8-slim-buster
  stage: release
  cache: { }
  script:
    - pip install -U twine
    - python setup.py sdist
    - twine upload dist/*
  only:
    - tags
